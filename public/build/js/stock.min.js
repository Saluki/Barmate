app.collection=app.collection||{},app.collection.Categories=Backbone.Collection.extend({model:app.model.Category,url:"/app/stock/category",currentID:-1,changeCurrentID:function(a){var b=parseInt(a);0>b||(this.currentID=b,this.trigger("changed"))}}),app.categories=new app.collection.Categories,app.collection=app.collection||{},app.collection.Products=Backbone.Collection.extend({model:app.model.Product,url:"/app/stock/product",currentID:-1}),app.products=new app.collection.Products,app.model=app.model||{},app.model.Category=Backbone.Model.extend({urlRoot:"/app/stock/category",initialize:function(){},defaults:{title:"",description:"",active:!0}}),app.model=app.model||{},app.model.Product=Backbone.Model.extend({urlRoot:"/app/stock/product",initialize:function(){},defaults:{category:0,name:"",description:"",price:0,quantity:0}}),app.views=app.views||{},app.views.CategoryForm=Backbone.View.extend({el:"#new-category-form",initialize:function(){this.$inputTitle=$("#c-title"),this.$inputDescription=$("#c-description"),this.$saveButton=$("#btn-save-category")},events:{"click #btn-save-category":"saveCategory"},render:function(){return this},saveCategory:function(){var a=this.$inputTitle.val(),b=this.$inputDescription.val();if(a.length<1)var c="Title may not be empty";if(a.length>50)var c="Title may not be longer than 50 characters";if(void 0!=c)return void alertify.error(c);var d=this,e=new app.model.Category({title:a,description:b});e.save(null,{success:function(a){app.categories.add(e),d.clearForm(),alertify.success("Category <i>"+a.get("title")+"</i> created")},error:function(){alertify.error("Problem on the server")}})},clearForm:function(){this.$inputTitle.val(""),this.$inputDescription.val("")}}),app.views=app.views||{},app.views.CategoryItem=Backbone.View.extend({className:"category-item",editMode:!1,templateDefault:_.template($("#template-category").html()),templateEdit:_.template($("#template-category-edit").html()),initialize:function(){},events:{"click .title":"changeCurrentCategory","click .remove":"deleteCategory","click .edit":"editCategory","click .update":"updateCategory","click .cancel":"cancelEdit"},render:function(){if(0==this.editMode)var a=this.templateDefault(this.model.toJSON());else var a=this.templateEdit(this.model.toJSON());return this.$el.html(a),this},changeCurrentCategory:function(){app.categories.changeCurrentID(this.model.get("id"))},deleteCategory:function(){currentView=this,this.model.destroy({success:function(){currentView.remove()},error:function(a,b){alertify.error(b.responseJSON.error)}})},editCategory:function(){this.editMode=!0,this.render()},updateCategory:function(){var a=$("#input-title").val(),b=$("#input-description").val();if(a.length<1)var c="Title may not be empty";if(a.length>50)var c="Title may not be longer than 50 characters";if(void 0!=c)return void alertify.error(c);var d=this;this.model.set({title:a,description:b}),this.model.save(null,{success:function(){d.editMode=!1,d.render()},error:function(a,b){alertify.error(b.responseJSON.error)}})},cancelEdit:function(){this.editMode=!1,this.render()}}),app.views=app.views||{},app.views.CategoryList=Backbone.View.extend({el:"#category-list",events:{},initialize:function(){this.listenTo(app.categories,"reset",this.render),this.listenTo(app.categories,"add",this.render)},render:function(){return this.$el.html(""),app.categories.each(this.addToView,this),this},addToView:function(a){var b=new app.views.CategoryItem({model:a});this.$el.append(b.render().el)}}),app.views=app.views||{},app.views.ProductDisplay=Backbone.View.extend({el:"#product-display",editMode:!1,templateDisplay:_.template($("#template-product-display").html()),templateEdit:_.template($("#template-product-edit").html()),events:{"click #remove-product":"askRemove","click #edit-product":"editProduct","click #cancel-edit":"displayMode","click #update-product":"updateProduct"},initialize:function(){this.listenTo(app.categories,"changed",this.clear)},render:function(){var a=app.products.get(app.products.currentID);if(void 0!=a){if(0==this.editMode)var b=this.templateDisplay(a.toJSON());else var b=this.templateEdit(a.toJSON());return this.editMode=!1,this.trigger("render"),this.$el.html(b),this}},askRemove:function(){alertify.confirm("Confirm that you want to delete the product",this.removeProduct)},removeProduct:function(){var a=app.products.get(app.products.currentID);void 0!=a&&a.destroy({success:function(){app.productDisplay.clear(),app.productList.render()},error:function(a,b){console.log(b)}})},updateProduct:function(){var a=app.products.get(app.products.currentID);if(void 0!=a){var b=$("#product-update-name").val(),c=$("#product-update-description").val(),d=parseInt($("#product-update-price").val()),e=parseInt($("#product-update-qt").val());if(""!=b){a.set({name:b,description:c,price:d,quantity:e});var f=this;a.save(null,{success:function(){f.displayMode()},error:function(a,b){console.log(b)}})}}},editProduct:function(){this.editMode=!0,this.render()},displayMode:function(){this.editMode=!1,this.render()},clear:function(){this.$el.html("")}}),app.views=app.views||{},app.views.ProductForm=Backbone.View.extend({el:"#product-form",events:{"click #save-product-btn":"saveProduct"},initialize:function(){this.hide(),this.$inputName=$("#p-name"),this.$inputDescription=$("#p-description"),this.$inputPrice=$("#p-price"),this.$inputQt=$("#p-quantity"),this.listenTo(app.productDisplay,"render",this.hide)},render:function(){return this},show:function(){app.productDisplay.clear(),app.productForm.$el.show()},hide:function(){this.$el.hide()},saveProduct:function(){var a=this.$inputName.val(),b=this.$inputDescription.val(),c=parseInt(this.$inputPrice.val()),d=parseInt(this.$inputQt.val());if(void 0!=app.categories.currentID&&-1!=app.categories.currentID){var e=new app.model.Product({category:app.categories.currentID,name:a,description:b,price:c,quantity:d}),f=this;e.save(null,{success:function(){app.products.add(e),app.productList.render(),f.clearForm()},error:function(a,b){alertify.error(b.responseJSON.message)}})}},clearForm:function(){this.$inputName.val(""),this.$inputDescription.val(""),this.$inputPrice.val(""),this.$inputQt.val("")}}),app.views=app.views||{},app.views.ProductList=Backbone.View.extend({el:"#product-list",template:_.template($("#template-product-list").html()),events:{"click .product":"displayProduct","click #add-product-btn":"showForm"},initialize:function(){this.listenTo(app.categories,"changed",this.render)},render:function(){var a=app.products.where({category:app.categories.currentID}),b=this.template({products:a});return app.productForm.hide(),this.$el.html(b),this},displayProduct:function(a){var b=$(a.target).data("product");void 0!=b&&(app.products.currentID=b,app.productDisplay.render())},showForm:function(){app.productForm.show()}});var app=app||{};$(document).ready(function(){alertify.set("notifier","position","top-right"),alertify.defaults.glossary.title="Barmate",app.categoryList=new app.views.CategoryList,app.categoryForm=new app.views.CategoryForm,app.productList=new app.views.ProductList,app.productDisplay=new app.views.ProductDisplay,app.productForm=new app.views.ProductForm,app.categories.reset(categoryData),app.products.fetch({reset:!0})});