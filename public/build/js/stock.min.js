app.model=app.model||{},app.model.Category=Backbone.Model.extend({urlRoot:"/app/stock/category",initialize:function(){},defaults:{title:"",description:"",active:!0}}),app.model=app.model||{},app.model.Product=Backbone.Model.extend({urlRoot:"/app/stock/product",initialize:function(){},defaults:{category:0,name:"",description:"",price:0,quantity:0}}),app.collection=app.collection||{},app.collection.Categories=Backbone.Collection.extend({model:app.model.Category,url:"/app/stock/category",currentID:-1,resetCurrentID:function(){this.currentID=-1,this.trigger("changed")},changeCurrentID:function(a){var b=parseInt(a);0>b||(this.currentID=b,this.trigger("changed"))}}),app.categories=new app.collection.Categories,app.collection=app.collection||{},app.collection.Products=Backbone.Collection.extend({model:app.model.Product,url:"/app/stock/product",currentID:-1}),app.products=new app.collection.Products,app.views=app.views||{},app.views.CategoryForm=Backbone.View.extend({el:"#new-category-form",initialize:function(){this.$inputTitle=$("#c-title"),this.$inputDescription=$("#c-description"),this.$saveButton=$("#btn-save-category")},events:{"click #btn-save-category":"saveCategory"},render:function(){return this},saveCategory:function(){var a,b=this.$inputTitle.val(),c=this.$inputDescription.val();if(b.length<1&&(a="Title may not be empty"),b.length>50&&(a="Title may not be longer than 50 characters"),void 0!==a)return void alertify.error(a);var d=this,e=new app.model.Category({title:b,description:c});e.save(null,{success:function(a,b){app.categories.add(e),d.clearForm(),alertify.success("Category <i>"+a.get("title")+"</i> created")},error:function(a,b){b.responseJSON.error?alertify.error(b.responseJSON.error):alertify.error("Problem on the server")}})},clearForm:function(){this.$inputTitle.val(""),this.$inputDescription.val("")}}),app.views=app.views||{},app.views.CategoryItem=Backbone.View.extend({className:"category-item",editMode:!1,templateDefault:_.template($("#template-category").html()),templateEdit:_.template($("#template-category-edit").html()),initialize:function(){this.listenTo(app.categories,"changed",this.setInactive)},events:{"click .title":"changeCurrentCategory","click .remove":"deleteCategory","click .edit":"editCategory","click .update":"updateCategory","click .cancel":"cancelEdit"},render:function(){this.$el.html();var a;return a=this.editMode===!1?this.templateDefault(this.model.toJSON()):this.templateEdit(this.model.toJSON()),this.$el.html(a),this},changeCurrentCategory:function(a){app.categories.changeCurrentID(this.model.get("id")),this.$el.addClass("active")},deleteCategory:function(a){currentView=this,this.model.destroy({success:function(a,b){currentView.remove(),app.categories.resetCurrentID(),alertify.success("Category <i>"+a.get("title")+"</i> deleted")},error:function(a,b){alertify.error(b.responseJSON.error)}})},editCategory:function(a){this.editMode=!0,this.render()},updateCategory:function(a){var b,c=$("#input-title").val(),d=$("#input-description").val();if(c.length<1&&(b="Title may not be empty"),c.length>50&&(b="Title may not be longer than 50 characters"),void 0!==b)return void alertify.error(b);var e=this;this.model.set({title:c,description:d}),this.model.save(null,{success:function(a,b){e.editMode=!1,e.render()},error:function(a,b){alertify.error(b.responseJSON.error)}})},cancelEdit:function(a){this.editMode=!1,this.render()},setInactive:function(){this.$el.removeClass("active"),this.cancelEdit()}}),app.views=app.views||{},app.views.CategoryList=Backbone.View.extend({el:"#category-list",events:{},initialize:function(){this.listenTo(app.categories,"reset",this.render),this.listenTo(app.categories,"add",this.render)},render:function(){return this.$el.html(""),app.categories.each(this.addToView,this),app.productList.render(),this},addToView:function(a){var b=new app.views.CategoryItem({model:a});this.$el.append(b.render().el)}}),app.views=app.views||{},app.views.ProductDisplay=Backbone.View.extend({el:"#product-display",editMode:!1,templateDisplay:_.template($("#template-product-display").html()),templateEdit:_.template($("#template-product-edit").html()),events:{"click #remove-product":"askRemove","click #edit-product":"editProduct","click #cancel-edit":"displayMode","click #update-product":"updateProduct"},initialize:function(){this.listenTo(app.categories,"changed",this.clear)},render:function(){var a=app.products.get(app.products.currentID);if(void 0!==a){var b;return b=this.editMode===!1?this.templateDisplay(a.toJSON()):this.templateEdit(a.toJSON()),this.editMode=!1,this.trigger("render"),this.$el.html(b),this}},askRemove:function(){alertify.confirm("Please confirm that you want to delete this product.",this.removeProduct)},removeProduct:function(){var a=app.products.get(app.products.currentID);void 0!==a&&a.destroy({success:function(a,b){app.productDisplay.clear(),app.productList.render()},error:function(a,b){console.log(b)}})},updateProduct:function(){var a=app.products.get(app.products.currentID);if(void 0!==a){var b,c=$("#product-update-name").val(),d=$("#product-update-description").val(),e=parseFloat($("#product-update-price").val()),f=parseInt($("#product-update-qt").val());if((c.length<1||c.length>50)&&(b="Product name must be between 1 and 50 characters"),d.length>250&&(b="Description may not be longer than 250 characters"),(isNaN(e)||0>e)&&(b="Price must be a positive number"),(isNaN(f)||0>f)&&(b="Quantity must be a positive integer"),void 0!==b)return void alertify.error(b);a.set({name:c,description:d,price:e,quantity:f});var g=this;a.save(null,{success:function(a,b){g.displayMode(),app.productList.render(),alertify.success("Product <i>"+a.get("name")+"</i> updated")},error:function(a,b){alertify.error(b.responseJSON.message)}})}},editProduct:function(){this.editMode=!0,this.render()},displayMode:function(){this.editMode=!1,this.render()},clear:function(){this.$el.html("")}}),app.views=app.views||{},app.views.ProductForm=Backbone.View.extend({el:"#product-form",events:{"click #save-product-btn":"saveProduct"},initialize:function(){this.hide(),this.$inputName=$("#p-name"),this.$inputDescription=$("#p-description"),this.$inputPrice=$("#p-price"),this.$inputQt=$("#p-quantity"),this.listenTo(app.productDisplay,"render",this.hide),this.listenTo(app.categories,"change",this.hide)},render:function(){return this},show:function(){app.productDisplay.clear(),app.productForm.$el.show()},hide:function(){this.$el.hide()},saveProduct:function(){var a=this.$inputName.val(),b=this.$inputDescription.val(),c=parseFloat(this.$inputPrice.val()),d=parseInt(this.$inputQt.val());if(void 0!==app.categories.currentID&&-1!=app.categories.currentID){var e;if((a.length<1||a.length>50)&&(e="Product name must be between 1 and 50 characters"),b.length>250&&(e="Description may not be longer than 250 characters"),(isNaN(c)||0>c)&&(e="Price must be a positive number"),(isNaN(d)||0>d)&&(e="Quantity must be a positive integer"),void 0!==e)return void alertify.error(e);var f=new app.model.Product({category:app.categories.currentID,name:a,description:b,price:c,quantity:d}),g=this;f.save(null,{success:function(a,b){app.products.add(f),app.productList.render(),g.clearForm()},error:function(a,b){alertify.error(b.responseJSON.message)}})}},clearForm:function(){this.$inputName.val(""),this.$inputDescription.val(""),this.$inputPrice.val(""),this.$inputQt.val("")}}),app.views=app.views||{},app.views.ProductList=Backbone.View.extend({el:"#product-list",template:_.template($("#template-product-list").html()),events:{"click .product":"displayProduct","click #add-product-btn":"showForm"},initialize:function(){this.listenTo(app.categories,"changed",this.render)},render:function(){var a;if(-1==app.categories.currentID)a="";else{var b=app.products.where({category:app.categories.currentID});a=this.template({products:b})}return app.productForm.hide(),this.$el.html(a),this},displayProduct:function(a){var b=$(a.target).data("product");void 0!==b&&(app.products.currentID=b,app.productDisplay.render())},showForm:function(a){app.productForm.show()}});var app=app||{};$(document).ready(function(){alertify.set("notifier","position","top-right"),alertify.defaults.glossary.title="Barmate",app.categoryList=new app.views.CategoryList,app.categoryForm=new app.views.CategoryForm,app.productList=new app.views.ProductList,app.productDisplay=new app.views.ProductDisplay,app.productForm=new app.views.ProductForm,app.categories.reset(categoryData),app.products.fetch({reset:!0})});